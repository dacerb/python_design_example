from typing import Optional, Dict, AnyStr

from example_compliance_engine.compliance_engine.chain_handler import ChainHandler


class VulnerabilityHigh(ChainHandler):
    def handler(self,  request):
        key_class: Optional[AnyStr] = self.__class__.__name__
        summary: Optional[Dict] = {}
        try:
            high_vulnerability = request.get("vulnerabilidades", {}).get("high", {})

            if len(high_vulnerability):
                summary[key_class]: AnyStr = f"high_vulnerability: {len(high_vulnerability)} is invalid"

        except Exception as e:
            print("problems with high_vulnerability validation")
            raise e

        if self._next_handler:
            result_summary = self._next_handler.handler(request)
            summary.update(result_summary)

        return summary